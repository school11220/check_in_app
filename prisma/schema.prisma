generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("POSTGRES_PRISMA_URL")
}

model AuditLog {
  id         String   @id
  action     String
  resource   String
  resourceId String?
  details    Json?
  userId     String
  userName   String
  userRole   String
  ipAddress  String?
  userAgent  String?
  createdAt  DateTime @default(now())

  @@index([action])
  @@index([createdAt])
  @@index([resource])
}

model Event {
  id                   String        @id
  name                 String
  description          String?
  date                 DateTime
  startTime            String        @default("09:00")
  endTime              String        @default("18:00")
  venue                String?
  address              String?
  price                Int           @default(0)
  entryFee             Int           @default(0)
  prizePool            Int           @default(0)
  category             String        @default("other")
  imageUrl             String?
  capacity             Int           @default(100)
  soldCount            Int           @default(0)
  isActive             Boolean       @default(true)
  isFeatured           Boolean       @default(false)
  schedule             Json          @default("[]")
  speakers             Json          @default("[]")
  sponsors             Json          @default("[]")
  tags                 String[]      @default([])
  organizer            String?
  contactEmail         String?
  contactPhone         String?
  termsAndConditions   String?
  registrationDeadline String?
  earlyBirdEnabled     Boolean       @default(false)
  earlyBirdPrice       Int           @default(0)
  earlyBirdDeadline    String?
  sendReminders        Boolean       @default(false)
  createdAt            DateTime      @default(now())
  updatedAt            DateTime
  registrationFields   Json          @default("[]")
  organizerVideoLink   String?
  videoLink            String?
  gallery              Json          @default("[]")
  PricingRule          PricingRule[]
  Review               Review[]
  Session              Session[]
  Ticket               Ticket[]

  @@index([category])
  @@index([isActive])
}

model Integration {
  id        String   @id
  provider  String   @unique
  name      String
  type      String
  isEnabled Boolean  @default(false)
  config    Json     @default("{}")
  createdAt DateTime @default(now())
  updatedAt DateTime
}

model PricingRule {
  id              String   @id
  eventId         String
  triggerType     String
  triggerValue    Int
  adjustmentType  String
  adjustmentValue Int
  active          Boolean  @default(true)
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  Event           Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([active])
  @@index([eventId])
}

model Review {
  id        String   @id
  eventId   String
  userName  String
  rating    Int
  comment   String
  createdAt DateTime @default(now())
  Event     Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId])
}

model Session {
  id              String   @id
  eventId         String
  title           String
  description     String?
  type            String   @default("talk")
  speakerName     String?
  speakerRole     String?
  startTime       String
  endTime         String
  date            String
  capacity        Int      @default(100)
  registeredCount Int      @default(0)
  createdAt       DateTime @default(now())
  updatedAt       DateTime
  Event           Event    @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([eventId])
}

model SiteConfig {
  id        String   @id @default("default")
  settings  Json     @default("{}")
  templates Json     @default("[]")
  createdAt DateTime @default(now())
  updatedAt DateTime
  surveys   Json     @default("[]")
}

model Ticket {
  id                String    @id
  name              String
  email             String?
  phone             String?
  eventId           String
  status            String    @default("pending")
  token             String?
  razorpayOrderId   String?
  razorpayPaymentId String?
  checkedIn         Boolean   @default(false)
  checkedInAt       DateTime?
  purchaseGroupId   String?
  createdAt         DateTime  @default(now())
  updatedAt         DateTime
  customAnswers     Json      @default("{}")
  Event             Event     @relation(fields: [eventId], references: [id], onDelete: Cascade)

  @@index([email])
  @@index([eventId])
  @@index([razorpayOrderId])
  @@index([status])
}


